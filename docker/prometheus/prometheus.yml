global:
  scrape_interval: 15s
  evaluation_interval: 15s

# Alertmanager configuration (optional)
alerting:
  alertmanagers:
    - static_configs:
        - targets: []

# Load rules (optional)
rule_files:
  - /etc/prometheus/rules/*.yml

# Scrape configurations
scrape_configs:
  # Prometheus self-monitoring
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']
        labels:
          service: 'prometheus'

  # =================================================================
  # DISABLED TARGETS - EXPLANATIONS
  # =================================================================

  # ❌ Temporal Server Metrics (DISABLED - Not Configured)
  # -----------------------------------------------------------------
  # The Temporal server (temporalio/auto-setup) CAN expose Prometheus metrics,
  # but it needs to be explicitly enabled in the server configuration.
  #
  # Current Issue:
  #   - Server is listening on port 7233 for gRPC API (not 9090)
  #   - Prometheus metrics endpoint (default port 9090) is not enabled
  #   - Attempting to scrape temporal:9090/metrics fails because the service
  #     doesn't expose a metrics endpoint on this port
  #
  # How to Enable Temporal Server Metrics:
  #   Option 1: Enable via environment variables in docker-compose.yml:
  #     environment:
  #       - TEMPORAL_METRICS_PROMETHEUS_LISTEN_ADDRESS=0.0.0.0:9090
  #
  #   Option 2: Enable via server configuration file (config/development.yaml):
  #     metrics:
  #       prometheus:
  #         listenAddress: "0.0.0.0:9090"
  #
  #   Option 3: Use OpenTelemetry exporter instead of Prometheus:
  #     - Configure OTEL collector to scrape Temporal metrics
  #     - Export to Prometheus via OTEL's prometheus_exporter
  #
  # Reference: https://docs.temporal.io/self-hosted-guide/monitoring
  # Reference: https://community.temporal.io/t/prometheus-metrics-configuration-confusion/6592
  #
  # Once enabled, update the scrape config below:
  # - job_name: 'temporal-server'
  #   metrics_path: /metrics
  #   static_configs:
  #     - targets: ['temporal:9090']
  #       labels:
  #         service: 'temporal-server'

  # ❌ Temporal UI Metrics (DISABLED - Not Supported)
  # -----------------------------------------------------------------
  # The Temporal UI (temporalio/ui) is a web-based dashboard interface and
  # does NOT expose Prometheus metrics endpoints.
  #
  # Current Issue:
  #   - temporal-ui:8080 returns HTML pages, not metrics
  #   - Prometheus cannot parse HTML as metrics format
  #   - Attempting to scrape temporal-ui:8080/metrics fails with errors
  #
  # Alternative Monitoring:
  #   - Monitor the UI service via container metrics (cAdvisor, Node Exporter)
  #   - Monitor Temporal server metrics instead (see above)
  #   - Monitor worker metrics (see below)
  #
  # NOTE: Even if UI had metrics, there's a port mismatch:
  #   - docker-compose maps 8080:8080 internally
  #   - But prometheus config was using 8080, which is correct
  #   - The real issue is that UI doesn't expose metrics at all

  # =================================================================
  # ACTIVE TARGETS - WORKING CONFIGURATIONS
  # =================================================================

  # ✅ Temporal Worker SDK Metrics (Active)
  # -----------------------------------------------------------------
  # This target scrapes metrics from the Temporal worker running on the
  # host machine. The worker exposes Prometheus metrics using the SDK's
  # built-in Prometheus exporter on port 9464.
  #
  # Configuration:
  #   - Worker SDK exposes metrics on host.docker.internal:9464
  #   - Metrics path: /metrics
  #   - Format: Prometheus exposition format
  #
  # This provides visibility into:
  #   - Workflow execution metrics
  #   - Activity task processing
  #   - Worker poll latency
  #   - Workflow history size
  #   - Task queue backlog
  #
  # Reference: https://docs.temporal.io/monitoring#metrics
  - job_name: 'temporal-worker'
    metrics_path: /metrics
    scrape_interval: 10s  # More frequent scraping for worker metrics
    static_configs:
      - targets: ['host.docker.internal:9464']
        labels:
          service: 'temporal-worker'
          environment: 'development'
          datacenter: 'local'
    relabel_configs:
      # Add instance label for better identification
      - source_labels: [__address__]
        target_label: instance
        replacement: 'local-worker'
